<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeHub | Discover Anime & Manga</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff6b6b;
            --secondary: #4ecdc4;
            --dark: #0f0c29;
            --darker: #0a081d;
            --light: #f8f9fa;
            --gray: #6c757d;
            --card-bg: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.1);
            --hover: rgba(255, 255, 255, 0.15);
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(78, 205, 196, 0.1) 0%, transparent 20%);
            z-index: -1;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: rgba(15, 12, 41, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .logo i {
            font-size: 2rem;
        }
        nav ul {
            display: flex;
            list-style: none;
            gap: 15px;
        }
        nav a {
            color: var(--light);
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--secondary);
        }
        .user-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .search-container {
            position: relative;
            width: 300px;
        }
        .search-container input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border-radius: 30px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-size: 0.9rem;
        }
        .search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 25px;
            margin-top: 20px;
        }
        .content-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title i {
            color: var(--secondary);
        }
        .view-all {
            color: var(--secondary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }
        .card-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        .card-content {
            padding: 15px;
        }
        .card-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: -webkit-box;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .card-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.85rem;
        }
        .rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #ffd700;
        }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        .sidebar-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }
        .sidebar-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sidebar-title i {
            color: var(--secondary);
        }
        .filter-group {
            margin-bottom: 15px;
        }
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        .filter-group select, .filter-group input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
            font-size: 0.9rem;
        }
        .genre-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .genre-tag {
            background: rgba(78, 205, 196, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .genre-tag:hover {
            background: rgba(78, 205, 196, 0.4);
        }
        .genre-tag.active {
            background: var(--secondary);
            color: white;
        }
        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
        }
        .favorite-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .favorite-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        .favorite-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        .favorite-content {
            padding: 15px;
        }
        .favorite-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
            display: -webkit-box;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .favorite-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.8rem;
        }
        .status-badge {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        .status-watching {
            background: rgba(78, 205, 196, 0.2);
            color: var(--secondary);
        }
        .status-completed {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        .status-planning {
            background: rgba(241, 196, 15, 0.2);
            color: var(--warning);
        }
        .status-paused {
            background: rgba(149, 165, 166, 0.2);
            color: #95a5a6;
        }
        .status-dropped {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
        }
        .page-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }
        .page-btn:hover, .page-btn.active {
            background: var(--primary);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.85rem;
            color: var(--gray);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            backdrop-filter: blur(5px);
            overflow-y: auto;
        }
        .modal-content {
            background: rgba(26, 26, 46, 0.95);
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border);
            margin-top: 50px;
        }
        .modal-header {
            position: relative;
            height: 300px;
            overflow: hidden;
        }
        .modal-banner {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(26, 26, 46, 1), transparent 60%);
        }
        .modal-content-inner {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            display: flex;
            gap: 20px;
            align-items: flex-end;
        }
        .modal-image {
            flex: 0 0 180px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--border);
        }
        .modal-image img {
            width: 100%;
            display: block;
        }
        .modal-info {
            flex: 1;
            color: white;
        }
        .modal-title {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .modal-native-title {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 15px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .modal-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .modal-detail {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }
        .modal-description {
            line-height: 1.6;
            color: #ddd;
            margin-bottom: 20px;
            font-size: 1rem;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 10px;
        }
        .modal-description::-webkit-scrollbar {
            width: 6px;
        }
        .modal-description::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        .modal-description::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 3px;
        }
        .modal-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card-modal {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }
        .stat-value-modal {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }
        .stat-label-modal {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .modal-section {
            padding: 20px;
        }
        .modal-section h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .genres-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .genre-tag-modal {
            background: rgba(78, 205, 196, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.3s;
            z-index: 10;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
        }
        .close-modal:hover {
            color: var(--primary);
            background: rgba(255, 107, 107, 0.2);
            transform: rotate(90deg);
        }
        .favorite-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .action-btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .action-btn:hover {
            background: var(--primary);
        }
        .action-btn.secondary {
            background: rgba(78, 205, 196, 0.2);
        }
        .action-btn.secondary:hover {
            background: rgba(78, 205, 196, 0.4);
        }
        .progress-container {
            margin-top: 15px;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--gray);
        }
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        .error {
            text-align: center;
            padding: 40px;
            color: var(--danger);
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
            border-top: 1px solid var(--border);
            color: var(--gray);
            font-size: 0.9rem;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            background: var(--success);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 2000;
        }
        .notification.show {
            transform: translateX(0);
        }
        /* Profile Styles */
        .profile-dropdown {
            position: relative;
            display: inline-block;
        }
        .profile-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        .profile-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .dropdown-content {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            width: 250px;
            padding: 15px;
            z-index: 1000;
            display: none;
        }
        .dropdown-content.show {
            display: block;
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .profile-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--secondary);
        }
        .profile-info h3 {
            font-size: 1.1rem;
            margin-bottom: 3px;
        }
        .profile-info p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        .profile-links {
            margin: 15px 0;
        }
        .profile-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s;
        }
        .profile-link:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .stat-card-profile {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        .stat-value-profile {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 3px;
        }
        .stat-label-profile {
            font-size: 0.75rem;
            color: var(--gray);
        }
        .profile-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
            text-align: center;
        }
        .logout-btn {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger);
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        .logout-btn:hover {
            background: rgba(231, 76, 60, 0.4);
        }
        .login-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .login-btn:hover {
            background: #ff5252;
        }
        /* User Profile Sections */
        .user-profile-section {
            margin-top: 20px;
        }
        .user-profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .user-profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--secondary);
        }
        .user-profile-info h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        .user-profile-info p {
            color: var(--gray);
            margin-bottom: 10px;
        }
        .user-profile-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        .user-stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 10px 15px;
            text-align: center;
            flex: 1;
        }
        .user-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--secondary);
        }
        .user-stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
        }
        .tab-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 20px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: var(--primary);
        }
        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }
        .list-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .list-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .list-item-img {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
        }
        .list-item-content {
            flex: 1;
        }
        .list-item-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .list-item-meta {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            color: var(--gray);
        }
        .list-item-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .list-item-actions {
            display: flex;
            gap: 10px;
        }
        .list-item-btn {
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
        }
        .list-item-btn:hover {
            background: var(--primary);
        }
        .list-item-btn.secondary {
            background: rgba(78, 205, 196, 0.2);
        }
        .list-item-btn.secondary:hover {
            background: rgba(78, 205, 196, 0.4);
        }
        .list-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .list-filter-group {
            flex: 1;
            min-width: 150px;
        }
        .progress-input {
            width: 80px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
            text-align: center;
        }
        .score-input {
            width: 80px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
            text-align: center;
        }
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                grid-row: 1;
            }
            .search-container {
                width: 200px;
            }
        }
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
            }
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            .search-container {
                width: 100%;
            }
            .modal-content-inner {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .modal-image {
                flex: 0 0 150px;
            }
            .modal-title {
                font-size: 1.5rem;
            }
            .cards-grid, .favorites-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
        @media (max-width: 480px) {
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .view-all {
                align-self: flex-end;
            }
            .modal-details {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-otaku"></i>
                <span>AnimeHub</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" data-tab="home"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#" data-tab="anime"><i class="fas fa-tv"></i> Anime</a></li>
                    <li><a href="#" data-tab="manga"><i class="fas fa-book"></i> Manga</a></li>
                    <li><a href="#" data-tab="seasonal"><i class="fas fa-calendar-alt"></i> Seasons</a></li>
                    <li><a href="#" data-tab="favorites"><i class="fas fa-heart"></i> Favorites</a></li>
                    <li><a href="#" data-tab="lists"><i class="fas fa-list"></i> My Lists</a></li>
                </ul>
            </nav>
            <div class="user-controls">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Search anime, manga...">
                </div>
                <div class="profile-dropdown">
                    <button class="profile-button" id="profile-btn">
                        <i class="fas fa-user-circle fa-2x"></i>
                    </button>
                    <div class="dropdown-content" id="dropdown-content">
                        <div class="profile-header">
                            <img src="https://ui-avatars.com/api/?name=User&size=50" alt="User Avatar" class="profile-avatar">
                            <div class="profile-info">
                                <h3 id="user-name">Guest User</h3>
                                <p id="user-since">Not logged in</p>
                            </div>
                        </div>
                        <div class="profile-links">
                            <a href="#" class="profile-link" data-tab="favorites">
                                <i class="fas fa-heart"></i> Favorites
                            </a>
                            <a href="#" class="profile-link" data-tab="lists">
                                <i class="fas fa-list"></i> My Lists
                            </a>
                            <a href="#" class="profile-link">
                                <i class="fas fa-cog"></i> Settings
                            </a>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-card-profile">
                                <div class="stat-value-profile" id="profile-anime-count">0</div>
                                <div class="stat-label-profile">Anime Watched</div>
                            </div>
                            <div class="stat-card-profile">
                                <div class="stat-value-profile" id="profile-manga-count">0</div>
                                <div class="stat-label-profile">Manga Read</div>
                            </div>
                            <div class="stat-card-profile">
                                <div class="stat-value-profile" id="profile-favorites-count">0</div>
                                <div class="stat-label-profile">Favorites</div>
                            </div>
                            <div class="stat-card-profile">
                                <div class="stat-value-profile" id="profile-watchlist-count">0</div>
                                <div class="stat-label-profile">Watchlist</div>
                            </div>
                        </div>
                        <div class="profile-footer">
                            <button class="login-btn" id="login-btn">
                                <i class="fab fa-anilist"></i> Login with AniList
                            </button>
                            <button class="logout-btn" id="logout-btn" style="display: none;">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <div class="main-content">
            <div class="content-section" id="content-area">
                <!-- Content will be loaded here dynamically -->
            </div>
            <div class="sidebar">
                <div class="sidebar-card">
                    <h3 class="sidebar-title"><i class="fas fa-filter"></i> Filters</h3>
                    <div class="filter-group">
                        <label for="type">Type</label>
                        <select id="type">
                            <option value="ALL">All Types</option>
                            <option value="ANIME">Anime</option>
                            <option value="MANGA">Manga</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="format">Format</label>
                        <select id="format">
                            <option value="ALL">All Formats</option>
                            <option value="TV">TV</option>
                            <option value="MOVIE">Movie</option>
                            <option value="OVA">OVA</option>
                            <option value="SPECIAL">Special</option>
                            <option value="ONA">ONA</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="year">Year</label>
                        <input type="number" id="year" placeholder="Enter year" min="1950" max="2030">
                    </div>
                    <div class="filter-group">
                        <label for="status">Status</label>
                        <select id="status">
                            <option value="ALL">All Status</option>
                            <option value="FINISHED">Finished</option>
                            <option value="RELEASING">Releasing</option>
                            <option value="NOT_YET_RELEASED">Not Yet Released</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Genres</label>
                        <div class="genre-list" id="genre-tags">
                            <!-- Genre tags will be populated here -->
                        </div>
                    </div>
                </div>
                <div class="sidebar-card">
                    <h3 class="sidebar-title"><i class="fas fa-chart-line"></i> Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="anime-count">0</div>
                            <div class="stat-label">Anime</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="manga-count">0</div>
                            <div class="stat-label">Manga</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="user-count">0</div>
                            <div class="stat-label">Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="review-count">0</div>
                            <div class="stat-label">Reviews</div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-card">
                    <h3 class="sidebar-title"><i class="fas fa-heart"></i> Your Favorites</h3>
                    <div class="favorites-grid" id="favorites-display">
                        <!-- Favorites will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <p>AnimeHub &copy; 2023 | Powered by AniList API</p>
            <p>This is a fan project and not affiliated with AniList.</p>
        </footer>
    </div>
    <!-- Modal for media details -->
    <div class="modal" id="media-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="modal-body">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>
    <!-- Notification -->
    <div class="notification" id="notification">
        Item added to favorites!
    </div>
    <script>
        // Global variables
        let currentTab = 'home';
        let currentPage = 1;
        let totalPages = 1;
        let currentSearchTerm = '';
        let currentFavorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let animeList = JSON.parse(localStorage.getItem('animeList')) || [];
        let mangaList = JSON.parse(localStorage.getItem('mangaList')) || [];
        let currentUser = null;
        let genres = [];
        let allMedia = [];
        let filteredMedia = [];
        // DOM Elements
        const contentArea = document.getElementById('content-area');
        const searchInput = document.getElementById('search-input');
        const modal = document.getElementById('media-modal');
        const modalBody = document.getElementById('modal-body');
        const closeModal = document.querySelector('.close-modal');
        const notification = document.getElementById('notification');
        const genreTagsContainer = document.getElementById('genre-tags');
        const animeCount = document.getElementById('anime-count');
        const mangaCount = document.getElementById('manga-count');
        const userCount = document.getElementById('user-count');
        const reviewCount = document.getElementById('review-count');
        const favoritesDisplay = document.getElementById('favorites-display');
        const profileBtn = document.getElementById('profile-btn');
        const dropdownContent = document.getElementById('dropdown-content');
        const logoutBtn = document.getElementById('logout-btn');
        const loginBtn = document.getElementById('login-btn');
        const userName = document.getElementById('user-name');
        const userSince = document.getElementById('user-since');
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Load initial data
            loadGenres();
            loadStats();
            loadFavoritesDisplay();
            // Set up event listeners
            setupEventListeners();
            // Load home content
            loadHomeContent();
            // Load profile stats
            loadProfileStats();
            // Check if user is already logged in
            checkLoginStatus();
        });
        // Set up event listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('nav a').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                    tab.classList.add('active');
                    currentTab = tab.dataset.tab;
                    loadContent();
                });
            });
            // Search functionality
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    currentSearchTerm = searchInput.value.trim();
                    loadContent();
                }
            });
            // Modal close
            closeModal.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
            // Profile dropdown
            profileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdownContent.classList.toggle('show');
            });
            // Close dropdown when clicking elsewhere
            document.addEventListener('click', (e) => {
                if (!profileBtn.contains(e.target) && !dropdownContent.contains(e.target)) {
                    dropdownContent.classList.remove('show');
                }
            });
            // Logout
            logoutBtn.addEventListener('click', () => {
                logoutUser();
            });
            // Login
            loginBtn.addEventListener('click', () => {
                loginUser();
            });
            // Profile links
            document.querySelectorAll('.profile-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tab = link.dataset.tab;
                    if (tab) {
                        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                        const tabLink = document.querySelector(`nav a[data-tab="${tab}"]`);
                        if (tabLink) {
                            tabLink.classList.add('active');
                            currentTab = tab;
                            loadContent();
                            dropdownContent.classList.remove('show');
                        }
                    }
                });
            });
            // Filter changes
            document.getElementById('type').addEventListener('change', loadContent);
            document.getElementById('format').addEventListener('change', loadContent);
            document.getElementById('year').addEventListener('change', loadContent);
            document.getElementById('status').addEventListener('change', loadContent);
            // Genre tag clicks
            genreTagsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('genre-tag')) {
                    e.target.classList.toggle('active');
                    loadContent();
                }
            });
        }
        // Check login status
        function checkLoginStatus() {
            const token = localStorage.getItem('anilist_token');
            if (token) {
                // User is logged in
                fetchUserData(token);
            } else {
                // User is not logged in
                updateUserUI(false);
            }
        }
        // Login user
        function loginUser() {
            const clientId = '29049'; // Your actual Client ID
            const redirectUri = encodeURIComponent('https://streamall-phi.vercel.app/');
            const authUrl = `https://anilist.co/api/v2/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code`;
            window.location.href = authUrl;
        }
        // Handle OAuth callback
        function handleOAuthCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (code) {
                // Exchange code for token
                exchangeCodeForToken(code);
            }
        }
        // Exchange authorization code for access token
        async function exchangeCodeForToken(code) {
            try {
                console.log('Exchanging code for token...');
                console.log('Code received:', code);
                
                // Call your Vercel serverless function
                const response = await fetch('/api/auth/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        code: code
                    })
                });
                
                const data = await response.json();
                console.log('Token response:', data);
                
                if (data.access_token) {
                    // Store token
                    localStorage.setItem('anilist_token', data.access_token);
                    // Fetch user data
                    fetchUserData(data.access_token);
                    // Remove code from URL
                    window.history.pushState({}, document.title, window.location.pathname);
                } else {
                    console.error('Failed to get access token:', data);
                    if (data.error) {
                        showNotification(`Login failed: ${data.error} - ${data.message}`);
                    } else {
                        showNotification('Login failed. Please try again.');
                    }
                }
            } catch (error) {
                console.error('Error exchanging code for token:', error);
                showNotification('Login failed. Please try again.');
            }
        }
        // Fetch user data
        async function fetchUserData(token) {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        query: `
                            query {
                                Viewer {
                                    id
                                    name
                                    avatar {
                                        large
                                    }
                                    bannerImage
                                    about(format: HTML)
                                    statistics {
                                        anime {
                                            count
                                            episodesWatched
                                            meanScore
                                        }
                                        manga {
                                            count
                                            chaptersRead
                                            meanScore
                                        }
                                    }
                                    mediaListOptions {
                                        scoreFormat
                                    }
                                }
                            }
                        `
                    })
                });
                
                const data = await response.json();
                if (data.data && data.data.Viewer) {
                    currentUser = data.data.Viewer;
                    updateUserUI(true);
                    showNotification('Successfully logged in!');
                    
                    // Fetch user's lists after login
                    fetchUserLists(token);
                } else {
                    console.error('Failed to fetch user ', data);
                    showNotification('Failed to fetch user data');
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
                showNotification('Failed to fetch user data');
            }
        }
        // Fetch user's anime and manga lists
        async function fetchUserLists(token) {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        query: `
                            query {
                                MediaListCollection(userId: null, type: ANIME) {
                                    lists {
                                        name
                                        entries {
                                            media {
                                                id
                                                title {
                                                    romaji
                                                    english
                                                }
                                                coverImage {
                                                    large
                                                }
                                                episodes
                                                chapters
                                                format
                                                status
                                            }
                                            progress
                                            score
                                            status
                                        }
                                    }
                                }
                                MediaListCollection(userId: null, type: MANGA) {
                                    lists {
                                        name
                                        entries {
                                            media {
                                                id
                                                title {
                                                    romaji
                                                    english
                                                }
                                                coverImage {
                                                    large
                                                }
                                                episodes
                                                chapters
                                                format
                                                status
                                            }
                                            progress
                                            score
                                            status
                                        }
                                    }
                                }
                            }
                        `
                    })
                });
                
                const data = await response.json();
                if (data.data) {
                    // Process anime list
                    const animeEntries = data.data.MediaListCollection?.lists.flatMap(list => list.entries || []) || [];
                    animeList = animeEntries.map(entry => ({
                        id: entry.media.id,
                        title: entry.media.title.english || entry.media.title.romaji || 'Untitled',
                        image: entry.media.coverImage.large,
                        type: 'anime',
                        status: entry.status,
                        score: entry.score ? (entry.score / 10).toFixed(1) : 0,
                        progress: entry.progress,
                        maxProgress: entry.media.episodes || entry.media.chapters || 0,
                        createdAt: new Date().toISOString()
                    }));
                    
                    // Process manga list
                    const mangaEntries = data.data.MediaListCollection?.lists.flatMap(list => list.entries || []) || [];
                    mangaList = mangaEntries.map(entry => ({
                        id: entry.media.id,
                        title: entry.media.title.english || entry.media.title.romaji || 'Untitled',
                        image: entry.media.coverImage.large,
                        type: 'manga',
                        status: entry.status,
                        score: entry.score ? (entry.score / 10).toFixed(1) : 0,
                        progress: entry.progress,
                        maxProgress: entry.media.episodes || entry.media.chapters || 0,
                        createdAt: new Date().toISOString()
                    }));
                    
                    // Save to localStorage
                    saveLists();
                    
                    // Update UI if on lists page
                    if (currentTab === 'lists') {
                        loadListsContent();
                    }
                }
            } catch (error) {
                console.error('Error fetching user lists:', error);
            }
        }
        // Update UI based on login status
        function updateUserUI(isLoggedIn) {
            if (isLoggedIn && currentUser) {
                // Update user info
                userName.textContent = currentUser.name;
                userSince.textContent = `Member since ${new Date().getFullYear()}`;
                
                // Show logout button, hide login button
                logoutBtn.style.display = 'block';
                loginBtn.style.display = 'none';
                
                // Update profile stats with user data
                if (currentUser.statistics) {
                    document.getElementById('profile-anime-count').textContent = currentUser.statistics.anime.episodesWatched || 0;
                    document.getElementById('profile-manga-count').textContent = currentUser.statistics.manga.chaptersRead || 0;
                    document.getElementById('profile-favorites-count').textContent = currentFavorites.length;
                    document.getElementById('profile-watchlist-count').textContent = 0; // No watchlist
                }
            } else {
                // Reset to guest mode
                userName.textContent = 'Guest User';
                userSince.textContent = 'Not logged in';
                
                // Show login button, hide logout button
                logoutBtn.style.display = 'none';
                loginBtn.style.display = 'block';
                
                // Reset profile stats
                document.getElementById('profile-anime-count').textContent = '0';
                document.getElementById('profile-manga-count').textContent = '0';
                document.getElementById('profile-favorites-count').textContent = currentFavorites.length;
                document.getElementById('profile-watchlist-count').textContent = '0';
            }
        }
        // Logout user
        function logoutUser() {
            localStorage.removeItem('anilist_token');
            currentUser = null;
            updateUserUI(false);
            showNotification('Logged out successfully');
        }
        // Load genres from API
        async function loadGenres() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query {
                                GenreCollection
                            }
                        `
                    })
                });
                const data = await response.json();
                if (data.data && data.data.GenreCollection) {
                    genres = data.data.GenreCollection;
                    renderGenreTags();
                }
            } catch (error) {
                console.error('Error loading genres:', error);
            }
        }
        // Render genre tags
        function renderGenreTags() {
            genreTagsContainer.innerHTML = '';
            genres.forEach(genre => {
                const tag = document.createElement('div');
                tag.className = 'genre-tag';
                tag.textContent = genre;
                tag.dataset.genre = genre;
                genreTagsContainer.appendChild(tag);
            });
        }
        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query {
                                anime: Page(page: 1, perPage: 1) {
                                    pageInfo {
                                        total
                                    }
                                }
                                manga: Page(page: 1, perPage: 1) {
                                    pageInfo {
                                        total
                                    }
                                }
                                users: Page(page: 1, perPage: 1) {
                                    pageInfo {
                                        total
                                    }
                                }
                                reviews: Page(page: 1, perPage: 1) {
                                    pageInfo {
                                        total
                                    }
                                }
                            }
                        `
                    })
                });
                const data = await response.json();
                if (data.data) {
                    animeCount.textContent = data.data.anime.pageInfo.total.toLocaleString();
                    mangaCount.textContent = data.data.manga.pageInfo.total.toLocaleString();
                    userCount.textContent = data.data.users.pageInfo.total.toLocaleString();
                    reviewCount.textContent = data.data.reviews.pageInfo.total.toLocaleString();
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        // Load favorites display
        function loadFavoritesDisplay() {
            if (currentFavorites.length === 0) {
                favoritesDisplay.innerHTML = '<div class="empty-state"><i class="fas fa-heart"></i><p>No favorites yet</p></div>';
                return;
            }
            favoritesDisplay.innerHTML = '';
            const limitedFavorites = currentFavorites.slice(0, 3);
            limitedFavorites.forEach(fav => {
                const card = document.createElement('div');
                card.className = 'favorite-card';
                card.dataset.id = fav.id;
                card.innerHTML = `
                    <img src="${fav.image}" alt="${fav.title}" class="favorite-img">
                    <div class="favorite-content">
                        <h3 class="favorite-title">${fav.title}</h3>
                        <div class="favorite-meta">
                            <span class="status-badge status-${fav.status}">${getStatusText(fav.status)}</span>
                        </div>
                    </div>
                `;
                favoritesDisplay.appendChild(card);
                // Add click event to open detail view
                card.addEventListener('click', () => {
                    openMediaDetails(fav.id);
                });
            });
        }
        // Get status text
        function getStatusText(status) {
            const statusMap = {
                'watching': 'Watching',
                'reading': 'Reading',
                'completed': 'Completed',
                'planning': 'Planning',
                'paused': 'Paused',
                'dropped': 'Dropped'
            };
            return statusMap[status] || status;
        }
        // Load content based on current tab
        function loadContent() {
            switch(currentTab) {
                case 'home':
                    loadHomeContent();
                    break;
                case 'anime':
                    loadAnimeContent();
                    break;
                case 'manga':
                    loadMangaContent();
                    break;
                case 'seasonal':
                    loadSeasonalContent();
                    break;
                case 'favorites':
                    loadFavoritesContent();
                    break;
                case 'lists':
                    loadListsContent();
                    break;
                default:
                    loadHomeContent();
            }
        }
        // Load home content
        function loadHomeContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-fire"></i> Trending Now</h2>
                    <a href="#" class="view-all" data-tab="anime">View All</a>
                </div>
                <div class="cards-grid" id="trending-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading trending content...</p>
                    </div>
                </div>
                <div class="section-header" style="margin-top: 30px;">
                    <h2 class="section-title"><i class="fas fa-star"></i> Top Rated</h2>
                    <a href="#" class="view-all" data-tab="anime">View All</a>
                </div>
                <div class="cards-grid" id="top-rated-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading top rated content...</p>
                    </div>
                </div>
            `;
            // Load trending and top rated content
            loadTrendingContent();
            loadTopRatedContent();
        }
        // Load trending content
        async function loadTrendingContent() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int) {
                                Page(page: $page, perPage: $perPage) {
                                    media(sort: TRENDING_DESC, type: ANIME) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: {
                            page: 1,
                            perPage: 8
                        }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'trending-grid');
                }
            } catch (error) {
                document.getElementById('trending-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading trending content</p>
                    </div>
                `;
                console.error('Error loading trending content:', error);
            }
        }
        // Load top rated content
        async function loadTopRatedContent() {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int) {
                                Page(page: $page, perPage: $perPage) {
                                    media(sort: SCORE_DESC, type: ANIME) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: {
                            page: 1,
                            perPage: 8
                        }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'top-rated-grid');
                }
            } catch (error) {
                document.getElementById('top-rated-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading top rated content</p>
                    </div>
                `;
                console.error('Error loading top rated content:', error);
            }
        }
        // Load anime content
        function loadAnimeContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-tv"></i> Anime</h2>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="cards-grid" id="anime-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading anime content...</p>
                    </div>
                </div>
                <div class="pagination" id="anime-pagination">
                    <!-- Pagination will be added here -->
                </div>
            `;
            loadAnimePage(1);
        }
        // Load anime page
        async function loadAnimePage(page) {
            try {
                const type = document.getElementById('type').value;
                const format = document.getElementById('format').value;
                const year = document.getElementById('year').value;
                const status = document.getElementById('status').value;
                const selectedGenres = Array.from(document.querySelectorAll('.genre-tag.active'))
                    .map(tag => tag.dataset.genre);
                // Build query variables
                const variables = {
                    page: page,
                    perPage: 24,
                    type: 'ANIME'
                };
                if (type !== 'ALL') variables.type = type;
                if (format !== 'ALL') variables.format = format;
                if (year) variables.seasonYear = parseInt(year);
                if (status !== 'ALL') variables.status = status;
                if (selectedGenres.length > 0) variables.genre_in = selectedGenres;
                if (currentSearchTerm) variables.search = currentSearchTerm;
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int, $type: MediaType, $search: String, $format: MediaFormat, $seasonYear: Int, $status: MediaStatus, $genre_in: [String]) {
                                Page(page: $page, perPage: $perPage) {
                                    pageInfo {
                                        total
                                        currentPage
                                        lastPage
                                        hasNextPage
                                    }
                                    media(
                                        type: $type
                                        search: $search
                                        format: $format
                                        seasonYear: $seasonYear
                                        status: $status
                                        genre_in: $genre_in
                                    ) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: variables
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'anime-grid');
                    renderPagination(data.data.Page.pageInfo, 'anime');
                }
            } catch (error) {
                document.getElementById('anime-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading anime content</p>
                    </div>
                `;
                console.error('Error loading anime content:', error);
            }
        }
        // Load manga content
        function loadMangaContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-book"></i> Manga</h2>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="cards-grid" id="manga-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading manga content...</p>
                    </div>
                </div>
                <div class="pagination" id="manga-pagination">
                    <!-- Pagination will be added here -->
                </div>
            `;
            loadMangaPage(1);
        }
        // Load manga page
        async function loadMangaPage(page) {
            try {
                const type = document.getElementById('type').value;
                const format = document.getElementById('format').value;
                const year = document.getElementById('year').value;
                const status = document.getElementById('status').value;
                const selectedGenres = Array.from(document.querySelectorAll('.genre-tag.active'))
                    .map(tag => tag.dataset.genre);
                // Build query variables
                const variables = {
                    page: page,
                    perPage: 24,
                    type: 'MANGA'
                };
                if (type !== 'ALL') variables.type = type;
                if (format !== 'ALL') variables.format = format;
                if (year) variables.seasonYear = parseInt(year);
                if (status !== 'ALL') variables.status = status;
                if (selectedGenres.length > 0) variables.genre_in = selectedGenres;
                if (currentSearchTerm) variables.search = currentSearchTerm;
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($page: Int, $perPage: Int, $type: MediaType, $search: String, $format: MediaFormat, $seasonYear: Int, $status: MediaStatus, $genre_in: [String]) {
                                Page(page: $page, perPage: $perPage) {
                                    pageInfo {
                                        total
                                        currentPage
                                        lastPage
                                        hasNextPage
                                    }
                                    media(
                                        type: $type
                                        search: $search
                                        format: $format
                                        seasonYear: $seasonYear
                                        status: $status
                                        genre_in: $genre_in
                                    ) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        chapters
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: variables
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'manga-grid');
                    renderPagination(data.data.Page.pageInfo, 'manga');
                }
            } catch (error) {
                document.getElementById('manga-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading manga content</p>
                    </div>
                `;
                console.error('Error loading manga content:', error);
            }
        }
        // Load seasonal content
        function loadSeasonalContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Seasonal</h2>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="cards-grid" id="seasonal-grid">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading seasonal content...</p>
                    </div>
                </div>
            `;
            loadSeasonalPage();
        }
        // Load seasonal page
        async function loadSeasonalPage() {
            try {
                const now = new Date();
                const currentMonth = now.getMonth();
                let season = '';
                let year = now.getFullYear();
                if (currentMonth >= 2 && currentMonth <= 4) {
                    season = 'SPRING';
                } else if (currentMonth >= 5 && currentMonth <= 7) {
                    season = 'SUMMER';
                } else if (currentMonth >= 8 && currentMonth <= 10) {
                    season = 'FALL';
                } else {
                    season = 'WINTER';
                    // If it's winter, we might need to adjust the year
                    if (currentMonth === 0) year -= 1;
                }
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($season: MediaSeason, $seasonYear: Int, $type: MediaType) {
                                Page(page: 1, perPage: 24) {
                                    media(
                                        season: $season
                                        seasonYear: $seasonYear
                                        type: $type
                                    ) {
                                        id
                                        title {
                                            romaji
                                            english
                                        }
                                        coverImage {
                                            large
                                            color
                                        }
                                        averageScore
                                        episodes
                                        seasonYear
                                    }
                                }
                            }
                        `,
                        variables: {
                            season: season,
                            seasonYear: year,
                            type: 'ANIME'
                        }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Page) {
                    renderCards(data.data.Page.media, 'seasonal-grid');
                }
            } catch (error) {
                document.getElementById('seasonal-grid').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading seasonal content</p>
                    </div>
                `;
                console.error('Error loading seasonal content:', error);
            }
        }
        // Load favorites content
        function loadFavoritesContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-heart"></i> My Favorites</h2>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="cards-grid" id="favorites-grid">
                    ${currentFavorites.length > 0 ? 
                        currentFavorites.map(fav => `
                            <div class="card favorite-card" data-id="${fav.id}">
                                <img src="${fav.image}" alt="${fav.title}" class="card-img">
                                <div class="card-content">
                                    <h3 class="card-title">${fav.title}</h3>
                                    <div class="card-meta">
                                        <span>${fav.type}</span>
                                        <span class="rating"><i class="fas fa-star"></i> ${fav.score}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('') : 
                        '<div class="empty-state"><i class="fas fa-heart"></i><p>No favorites yet</p></div>'
                    }
                </div>
            `;
            // Add event listeners to favorite cards
            document.querySelectorAll('.favorite-card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = card.dataset.id;
                    openMediaDetails(id);
                });
            });
        }
        // Load lists content
        function loadListsContent() {
            contentArea.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-list"></i> My Lists</h2>
                </div>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="anime">Anime List</button>
                    <button class="tab-btn" data-tab="manga">Manga List</button>
                    <button class="tab-btn" data-tab="favorites">Favorites</button>
                </div>
                <div id="list-content">
                    <!-- List content will be loaded here -->
                </div>
            `;
            
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    loadListContent();
                });
            });
            
            // Load initial list content
            loadListContent();
        }
        
        // Load list content based on active tab
        function loadListContent() {
            const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
            
            if (activeTab === 'anime') {
                renderAnimeList();
            } else if (activeTab === 'manga') {
                renderMangaList();
            } else if (activeTab === 'favorites') {
                renderFavoritesList();
            }
        }
        
        // Render anime list
        function renderAnimeList() {
            const listContent = document.getElementById('list-content');
            if (animeList.length === 0) {
                listContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tv"></i>
                        <p>No anime in your list</p>
                    </div>
                `;
                return;
            }
            
            listContent.innerHTML = animeList.map(item => `
                <div class="list-item" data-id="${item.id}">
                    <img src="${item.image}" alt="${item.title}" class="list-item-img">
                    <div class="list-item-content">
                        <h3 class="list-item-title">${item.title}</h3>
                        <div class="list-item-meta">
                            <span>${item.type}</span>
                            <span>${item.progress}/${item.maxProgress}</span>
                            <span class="list-item-status">
                                <i class="fas fa-tv"></i>
                                ${getStatusText(item.status)}
                            </span>
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <input type="number" class="progress-input" min="0" max="${item.maxProgress}" value="${item.progress}" 
                               onchange="updateProgress(${item.id}, 'anime', this)">
                        <input type="number" class="score-input" min="0" max="10" step="0.1" value="${item.score}" 
                               onchange="updateScore(${item.id}, 'anime', this)">
                        <button class="list-item-btn secondary" onclick="updateStatus(${item.id}, 'anime', 'completed')">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="list-item-btn" onclick="removeFromList(${item.id}, 'anime')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Render manga list
        function renderMangaList() {
            const listContent = document.getElementById('list-content');
            if (mangaList.length === 0) {
                listContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book"></i>
                        <p>No manga in your list</p>
                    </div>
                `;
                return;
            }
            
            listContent.innerHTML = mangaList.map(item => `
                <div class="list-item" data-id="${item.id}">
                    <img src="${item.image}" alt="${item.title}" class="list-item-img">
                    <div class="list-item-content">
                        <h3 class="list-item-title">${item.title}</h3>
                        <div class="list-item-meta">
                            <span>${item.type}</span>
                            <span>${item.progress}/${item.maxProgress}</span>
                            <span class="list-item-status">
                                <i class="fas fa-book"></i>
                                ${getStatusText(item.status)}
                            </span>
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <input type="number" class="progress-input" min="0" max="${item.maxProgress}" value="${item.progress}" 
                               onchange="updateProgress(${item.id}, 'manga', this)">
                        <input type="number" class="score-input" min="0" max="10" step="0.1" value="${item.score}" 
                               onchange="updateScore(${item.id}, 'manga', this)">
                        <button class="list-item-btn secondary" onclick="updateStatus(${item.id}, 'manga', 'completed')">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="list-item-btn" onclick="removeFromList(${item.id}, 'manga')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Render favorites list
        function renderFavoritesList() {
            const listContent = document.getElementById('list-content');
            if (currentFavorites.length === 0) {
                listContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart"></i>
                        <p>No favorites yet</p>
                    </div>
                `;
                return;
            }
            
            listContent.innerHTML = currentFavorites.map(item => `
                <div class="list-item" data-id="${item.id}">
                    <img src="${item.image}" alt="${item.title}" class="list-item-img">
                    <div class="list-item-content">
                        <h3 class="list-item-title">${item.title}</h3>
                        <div class="list-item-meta">
                            <span>${item.type}</span>
                            <span class="rating"><i class="fas fa-star"></i> ${item.score}</span>
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="list-item-btn" onclick="removeFromFavorites(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Update progress
        function updateProgress(id, type, element) {
            const value = parseInt(element.value);
            if (isNaN(value) || value < 0) return;
            
            const list = type === 'anime' ? animeList : mangaList;
            const item = list.find(i => i.id === id);
            if (item) {
                // Ensure progress doesn't exceed maxProgress
                if (value > item.maxProgress) {
                    element.value = item.maxProgress;
                    return;
                }
                
                item.progress = value;
                saveLists();
                loadListContent();
                showNotification(`Updated ${type} progress`);
            }
        }
        
        // Update score
        function updateScore(id, type, element) {
            const value = parseFloat(element.value);
            if (isNaN(value) || value < 0 || value > 10) return;
            
            const list = type === 'anime' ? animeList : mangaList;
            const item = list.find(i => i.id === id);
            if (item) {
                item.score = value;
                saveLists();
                loadListContent();
                showNotification(`Updated ${type} score`);
            }
        }
        
        // Update status
        function updateStatus(id, type, newStatus) {
            const list = type === 'anime' ? animeList : mangaList;
            const item = list.find(i => i.id === id);
            if (item) {
                item.status = newStatus;
                saveLists();
                loadListContent();
                showNotification(`Updated status to ${newStatus}`);
            }
        }
        
        // Remove from list
        function removeFromList(id, type) {
            if (confirm('Are you sure you want to remove this item from your list?')) {
                if (type === 'anime') {
                    animeList = animeList.filter(item => item.id !== id);
                } else {
                    mangaList = mangaList.filter(item => item.id !== id);
                }
                saveLists();
                loadListContent();
                showNotification(`${type === 'anime' ? 'Anime' : 'Manga'} removed from list`);
            }
        }
        
        // Remove from favorites
        function removeFromFavorites(id) {
            if (confirm('Are you sure you want to remove this item from favorites?')) {
                const index = currentFavorites.findIndex(item => item.id === id);
                if (index > -1) {
                    currentFavorites.splice(index, 1);
                    localStorage.setItem('favorites', JSON.stringify(currentFavorites));
                    loadListContent();
                    loadFavoritesDisplay();
                    loadProfileStats();
                    showNotification('Removed from favorites');
                }
            }
        }
        
        // Save lists to localStorage
        function saveLists() {
            localStorage.setItem('animeList', JSON.stringify(animeList));
            localStorage.setItem('mangaList', JSON.stringify(mangaList));
        }
        
        // Render cards
        function renderCards(mediaList, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            if (!mediaList || mediaList.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><p>No results found</p></div>';
                return;
            }
            container.innerHTML = mediaList.map(media => {
                const title = media.title.english || media.title.romaji || 'Untitled';
                const score = media.averageScore ? (media.averageScore / 10).toFixed(1) : 'N/A';
                const year = media.seasonYear || 'Unknown';
                const episodes = media.episodes || media.chapters || '?';
                const type = media.type || 'ANIME';
                return `
                    <div class="card" data-id="${media.id}">
                        <img src="${media.coverImage.large}" alt="${title}" class="card-img">
                        <div class="card-content">
                            <h3 class="card-title">${title}</h3>
                            <div class="card-meta">
                                <span>${year}</span>
                                <span class="rating"><i class="fas fa-star"></i> ${score}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            // Add click events to cards
            document.querySelectorAll(`#${containerId} .card`).forEach(card => {
                card.addEventListener('click', () => {
                    const id = card.dataset.id;
                    openMediaDetails(id);
                });
            });
        }
        // Render pagination
        function renderPagination(pageInfo, type) {
            const paginationContainer = document.getElementById(`${type}-pagination`);
            if (!paginationContainer) return;
            if (pageInfo.lastPage <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            let paginationHTML = '';
            // Previous button
            if (pageInfo.currentPage > 1) {
                paginationHTML += `
                    <button class="page-btn" onclick="changePage('${type}', ${pageInfo.currentPage - 1})">
                        <i class="fas fa-chevron-left"></i> Prev
                    </button>
                `;
            }
            // Page numbers
            const startPage = Math.max(1, pageInfo.currentPage - 2);
            const endPage = Math.min(pageInfo.lastPage, pageInfo.currentPage + 2);
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="page-btn ${i === pageInfo.currentPage ? 'active' : ''}" 
                            onclick="changePage('${type}', ${i})">
                        ${i}
                    </button>
                `;
            }
            // Next button
            if (pageInfo.hasNextPage) {
                paginationHTML += `
                    <button class="page-btn" onclick="changePage('${type}', ${pageInfo.currentPage + 1})">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            paginationContainer.innerHTML = paginationHTML;
        }
        // Change page
        function changePage(type, page) {
            currentPage = page;
            if (type === 'anime') {
                loadAnimePage(page);
            } else if (type === 'manga') {
                loadMangaPage(page);
            }
        }
        // Open media details modal
        async function openMediaDetails(id) {
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($id: Int) {
                                Media(id: $id) {
                                    id
                                    title {
                                        romaji
                                        english
                                        native
                                    }
                                    coverImage {
                                        large
                                        extraLarge
                                        color
                                    }
                                    bannerImage
                                    description(asHtml: false)
                                    genres
                                    averageScore
                                    meanScore
                                    popularity
                                    favourites
                                    status
                                    format
                                    startDate {
                                        year
                                        month
                                        day
                                    }
                                    endDate {
                                        year
                                        month
                                        day
                                    }
                                    episodes
                                    chapters
                                    volumes
                                    season
                                    seasonYear
                                    studios {
                                        nodes {
                                            name
                                        }
                                    }
                                    characters(sort: [ROLE, FAVOURITES_DESC], perPage: 6) {
                                        nodes {
                                            name {
                                                full
                                            }
                                            image {
                                                medium
                                            }
                                        }
                                    }
                                }
                            }
                        `,
                        variables: { id: id }
                    })
                });
                const data = await response.json();
                if (data.data && data.data.Media) {
                    displayMediaDetails(data.data.Media);
                    modal.style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching media details:', error);
                modalBody.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error loading details</p>
                    </div>
                `;
            }
        }
        // Display media details in modal
        function displayMediaDetails(media) {
            const title = media.title.english || media.title.romaji || 'Untitled';
            const nativeTitle = media.title.native || '';
            const description = media.description ? media.description.replace(/<[^>]*>/g, '').substring(0, 500) + '...' : 'No description available.';
            const genres = media.genres ? media.genres.join(', ') : 'N/A';
            const score = media.averageScore ? (media.averageScore / 10).toFixed(1) : 'N/A';
            const meanScore = media.meanScore ? (media.meanScore / 10).toFixed(1) : 'N/A';
            const startDate = media.startDate && media.startDate.year ? 
                `${media.startDate.year}-${media.startDate.month || '??'}-${media.startDate.day || '??'}` : 'Unknown';
            const endDate = media.endDate && media.endDate.year ? 
                `${media.endDate.year}-${media.endDate.month || '??'}-${media.endDate.day || '??'}` : 'Unknown';
            
            // Check if media is in favorites
            const isInFavorites = currentFavorites.some(fav => fav.id === media.id);
            const favoriteButtonText = isInFavorites ? 'Remove from Favorites' : 'Add to Favorites';
            const favoriteButtonClass = isInFavorites ? 'secondary' : '';
            
            // Check if media is in anime list
            const isInAnimeList = animeList.some(item => item.id === media.id);
            const animeListButtonText = isInAnimeList ? 'Remove from Anime List' : 'Add to Anime List';
            const animeListButtonClass = isInAnimeList ? 'secondary' : '';
            
            // Check if media is in manga list
            const isInMangaList = mangaList.some(item => item.id === media.id);
            const mangaListButtonText = isInMangaList ? 'Remove from Manga List' : 'Add to Manga List';
            const mangaListButtonClass = isInMangaList ? 'secondary' : '';
            
            modalBody.innerHTML = `
                <div class="modal-header">
                    <img src="${media.bannerImage || media.coverImage.extraLarge || media.coverImage.large}" alt="${title}" class="modal-banner">
                    <div class="modal-overlay"></div>
                    <div class="modal-content-inner">
                        <div class="modal-image">
                            <img src="${media.coverImage.extraLarge || media.coverImage.large}" alt="${title}" loading="lazy">
                        </div>
                        <div class="modal-info">
                            <h1 class="modal-title">${title}</h1>
                            ${nativeTitle ? `<h2 class="modal-native-title">${nativeTitle}</h2>` : ''}
                            <div class="modal-details">
                                <div class="modal-detail">${media.format || 'N/A'}</div>
                                <div class="modal-detail">${media.status || 'Unknown'}</div>
                                <div class="modal-detail">${startDate} - ${endDate}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3><i class="fas fa-info-circle"></i> Overview</h3>
                    <p class="modal-description">${description}</p>
                </div>
                <div class="modal-section">
                    <div class="modal-stats">
                        <div class="stat-card-modal">
                            <div class="stat-value-modal">${score}/10</div>
                            <div class="stat-label-modal">Average Score</div>
                        </div>
                        <div class="stat-card-modal">
                            <div class="stat-value-modal">${meanScore}/10</div>
                            <div class="stat-label-modal">Mean Score</div>
                        </div>
                        <div class="stat-card-modal">
                            <div class="stat-value-modal">${media.popularity?.toLocaleString() || 'N/A'}</div>
                            <div class="stat-label-modal">Popularity</div>
                        </div>
                        <div class="stat-card-modal">
                            <div class="stat-value-modal">${media.favourites?.toLocaleString() || 'N/A'}</div>
                            <div class="stat-label-modal">Favorites</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3><i class="fas fa-tags"></i> Genres</h3>
                    <div class="genres-list">
                        ${genres.split(', ').map(genre => `
                            <div class="genre-tag-modal">${genre}</div>
                        `).join('')}
                    </div>
                </div>
                <div class="modal-section">
                    <h3><i class="fas fa-list"></i> Details</h3>
                    <div class="modal-details">
                        <div class="modal-detail">${media.episodes ? `${media.episodes} episodes` : ''}</div>
                        <div class="modal-detail">${media.chapters ? `${media.chapters} chapters` : ''}</div>
                        <div class="modal-detail">${media.volumes ? `${media.volumes} volumes` : ''}</div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3><i class="fas fa-users"></i> Characters</h3>
                    <div class="cards-grid">
                        ${media.characters && media.characters.nodes ? 
                            media.characters.nodes.slice(0, 6).map(char => `
                                <div class="card">
                                    <img src="${char.image.medium}" alt="${char.name.full}" class="card-img">
                                    <div class="card-content">
                                        <h3 class="card-title">${char.name.full}</h3>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p>No characters available</p>'
                        }
                    </div>
                </div>
                <div class="favorite-actions">
                    <button class="action-btn ${favoriteButtonClass}" id="add-to-favorites">
                        <i class="fas fa-heart"></i> ${favoriteButtonText}
                    </button>
                    <button class="action-btn ${animeListButtonClass}" id="add-to-anime-list">
                        <i class="fas fa-tv"></i> ${animeListButtonText}
                    </button>
                    <button class="action-btn ${mangaListButtonClass}" id="add-to-manga-list">
                        <i class="fas fa-book"></i> ${mangaListButtonText}
                    </button>
                </div>
            `;
            // Add event listeners to action buttons
            document.getElementById('add-to-favorites').addEventListener('click', () => {
                addToFavorites(media);
            });
            document.getElementById('add-to-anime-list').addEventListener('click', () => {
                addToAnimeList(media);
            });
            document.getElementById('add-to-manga-list').addEventListener('click', () => {
                addToMangaList(media);
            });
        }
        // Add to favorites
        function addToFavorites(media) {
            // Check if already in favorites
            const existingIndex = currentFavorites.findIndex(fav => fav.id === media.id);
            if (existingIndex > -1) {
                // Remove from favorites
                currentFavorites.splice(existingIndex, 1);
                showNotification('Removed from favorites');
            } else {
                // Add to favorites
                const favorite = {
                    id: media.id,
                    title: media.title.english || media.title.romaji || 'Untitled',
                    image: media.coverImage.large,
                    type: media.format === 'MANGA' ? 'manga' : 'anime',
                    status: 'planning',
                    score: media.averageScore ? (media.averageScore / 10).toFixed(1) : 0,
                    progress: 0,
                    maxProgress: media.episodes || media.chapters || 0,
                    createdAt: new Date().toISOString()
                };
                currentFavorites.push(favorite);
                showNotification('Added to favorites!');
            }
            // Save to localStorage
            localStorage.setItem('favorites', JSON.stringify(currentFavorites));
            // Update favorites display
            loadFavoritesDisplay();
            // Update favorites content if currently on favorites tab
            if (currentTab === 'favorites') {
                loadFavoritesContent();
            }
            // Update profile stats
            loadProfileStats();
            // Update button in modal immediately
            if (modal.style.display === 'block') {
                const favoriteBtn = document.getElementById('add-to-favorites');
                const isCurrentlyInFavorites = currentFavorites.some(fav => fav.id === media.id);
                if (isCurrentlyInFavorites) {
                    favoriteBtn.textContent = 'Remove from Favorites';
                    favoriteBtn.className = 'action-btn secondary';
                } else {
                    favoriteBtn.textContent = 'Add to Favorites';
                    favoriteBtn.className = 'action-btn';
                }
            }
        }
        // Add to anime list
        function addToAnimeList(media) {
            // Check if already in anime list
            const existingIndex = animeList.findIndex(item => item.id === media.id);
            if (existingIndex > -1) {
                // Remove from anime list
                animeList.splice(existingIndex, 1);
                showNotification('Removed from anime list');
            } else {
                // Add to anime list
                const animeItem = {
                    id: media.id,
                    title: media.title.english || media.title.romaji || 'Untitled',
                    image: media.coverImage.large,
                    type: 'anime',
                    status: 'planning',
                    score: media.averageScore ? (media.averageScore / 10).toFixed(1) : 0,
                    progress: 0,
                    maxProgress: media.episodes || 0,
                    createdAt: new Date().toISOString()
                };
                animeList.push(animeItem);
                showNotification('Added to anime list!');
            }
            // Save to localStorage
            saveLists();
            // Update button in modal immediately
            if (modal.style.display === 'block') {
                const animeListBtn = document.getElementById('add-to-anime-list');
                const isCurrentlyInAnimeList = animeList.some(item => item.id === media.id);
                if (isCurrentlyInAnimeList) {
                    animeListBtn.textContent = 'Remove from Anime List';
                    animeListBtn.className = 'action-btn secondary';
                } else {
                    animeListBtn.textContent = 'Add to Anime List';
                    animeListBtn.className = 'action-btn';
                }
            }
        }
        // Add to manga list
        function addToMangaList(media) {
            // Check if already in manga list
            const existingIndex = mangaList.findIndex(item => item.id === media.id);
            if (existingIndex > -1) {
                // Remove from manga list
                mangaList.splice(existingIndex, 1);
                showNotification('Removed from manga list');
            } else {
                // Add to manga list
                const mangaItem = {
                    id: media.id,
                    title: media.title.english || media.title.romaji || 'Untitled',
                    image: media.coverImage.large,
                    type: 'manga',
                    status: 'planning',
                    score: media.averageScore ? (media.averageScore / 10).toFixed(1) : 0,
                    progress: 0,
                    maxProgress: media.chapters || 0,
                    createdAt: new Date().toISOString()
                };
                mangaList.push(mangaItem);
                showNotification('Added to manga list!');
            }
            // Save to localStorage
            saveLists();
            // Update button in modal immediately
            if (modal.style.display === 'block') {
                const mangaListBtn = document.getElementById('add-to-manga-list');
                const isCurrentlyInMangaList = mangaList.some(item => item.id === media.id);
                if (isCurrentlyInMangaList) {
                    mangaListBtn.textContent = 'Remove from Manga List';
                    mangaListBtn.className = 'action-btn secondary';
                } else {
                    mangaListBtn.textContent = 'Add to Manga List';
                    mangaListBtn.className = 'action-btn';
                }
            }
        }
        // Show notification
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        // Utility function to get current season
        function getCurrentSeason(month) {
            if (month >= 2 && month <= 4) return 'SPRING';
            if (month >= 5 && month <= 7) return 'SUMMER';
            if (month >= 8 && month <= 10) return 'FALL';
            return 'WINTER';
        }
        // Handle tab change for view all links
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('view-all')) {
                e.preventDefault();
                const tab = e.target.dataset.tab;
                if (tab) {
                    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                    const tabLink = document.querySelector(`nav a[data-tab="${tab}"]`);
                    if (tabLink) {
                        tabLink.classList.add('active');
                        currentTab = tab;
                        loadContent();
                    }
                }
            }
        });
        // Load profile stats
        function loadProfileStats() {
            const animeCount = currentFavorites.filter(fav => fav.type === 'anime').length;
            const mangaCount = currentFavorites.filter(fav => fav.type === 'manga').length;
            const favoritesCount = currentFavorites.length;
            const watchlistCount = 0; // No watchlist
            
            document.getElementById('profile-anime-count').textContent = animeCount;
            document.getElementById('profile-manga-count').textContent = mangaCount;
            document.getElementById('profile-favorites-count').textContent = favoritesCount;
            document.getElementById('profile-watchlist-count').textContent = watchlistCount;
        }
        
        // Check for OAuth callback when page loads
        window.addEventListener('load', () => {
            handleOAuthCallback();
        });
    </script>
</body>
</html>
